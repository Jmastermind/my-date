#:kivy 2.1.0
#:import hex kivy.utils.get_color_from_hex
#:import Clock kivy.clock.Clock
#:import NoTransition kivy.uix.screenmanager.NoTransition
#:import Factory kivy.factory.Factory

#:set main_color '1A1A1A'
#:set sec_color '212121'
#:set third_color '292929'
#:set forth_color '323232'
#:set complement_color '767676'
#:set accent_color 'B0B0B0'

#:set h1 18
#:set regular 15

<UI>:
    orientation: 'vertical'
    topbar_hint_y: .05
    dropdown: dropdown.__self__
    tint: 0, 0, 0, 0

    canvas.before:
        Color:
            rgba: hex(sec_color)
        Rectangle:
            pos: self.pos
            size: self.size

    TopBar:
        bg_color: hex(main_color)
        size_hint_y: root.topbar_hint_y

        Button:
            id: dd_btn
            text: 'Options'
            bold: True
            background_normal: ''
            background_down: ''
            background_color: 0, 0, 0, 0
            color: main_color
            font_size: sp(regular)
            on_press: dropdown.open(self); self.color=accent_color; root.tint=0, 0, 0, .5
            on_parent: dropdown.dismiss()

        DropDown:
            id: dropdown
            on_dismiss:
                dd_btn.color=complement_color
                reset_db_btn.color=complement_color
                add_activity.color=complement_color
                root.tint=0, 0, 0, 0

            Button:
                id: reset_db_btn
                text: 'Reset database'
                bold: True
                background_normal: ''
                background_down: ''
                background_color: hex(main_color)
                color: 1, 1, 1, .7
                font_size: sp(regular)
                size_hint_y: None
                height: '44dp'
                on_press: self.color=accent_color
                on_release: app.reset_data(); dropdown.dismiss();

            Button:
                id: add_activity
                text: 'Add activity'
                bold: True
                background_normal: ''
                background_down: ''
                background_color: hex(main_color)
                color: 1, 1, 1, .7
                font_size: sp(regular)
                size_hint_y: None
                height: '44dp'
                on_press: self.color=accent_color
                on_release: Factory.ActivityPopup().open(); dropdown.dismiss();


    ScrollView:
        do_scroll_x: False
        do_scroll_y: True
        effect_cls: 'ScrollEffect'
        scroll_group: scroll_group.__self__

        canvas.after:
            Color:
                rgba: root.tint
            Rectangle:
                pos: self.pos
                size: self.size

        BoxLayoutCanvas:
            id: scroll_group
            orientation: 'vertical'
            padding: sp(regular)
            size_hint_y: None
            size: self.minimum_size


<BackgroundColor@Widget>:
    bg_color: 1, 0, 0, 0
    canvas.before:
        Color:
            rgba: self.bg_color
        Rectangle:
            size: self.size
            pos: self.pos


<ActivityPopup@Popup>:
    title: 'Create new activity'
    title_align: 'center'
    title_color: accent_color
    title_size: sp(h1)
    size_hint: (.8, .25)
    separator_color: third_color
    background: ''
    background_color: sec_color
    overlay_color: 0, 0, 0, .5

    BoxLayout:
        orientation: 'vertical'
        padding: sp(10)
        spacing: sp(15)

        NameInput:
            id: new_activity_name
            hint_text: 'New activity name'
            multiline: False
            color: accent_color
            title_size: sp(regular)
            size_hint_y: .3

        DataInput:
            id: new_activity_data
            hint_text: 'Optional data (eg. 10:00 01.01.2000)'
            multiline: False
            color: accent_color
            title_size: sp(regular)
            size_hint_y: .3

        BoxLayout:
            size_hint_y: .4
            spacing: sp(10)

            BoxLayoutCanvas:
                bg_color: 1, 0, 0, 1
                CheckBox:
                    id: add_record
                    color: 1, 1, 1, 1
                    valign: 'center'
                    halign: 'center'
                    background_down: ''
                    background_normal: ''
                    size_hint_x: .25

                LabelCanvas:
                    # bg_color: 1, 0, 0, 1
                    text: 'Create record'
                    valign: 'center'
                    halign: 'left'
                    font_size: sp(regular)
                    size_hint_x: .75
                    text_size: self.size
                    bold: True
                    color: complement_color

            RoundedButton:
                text: 'Create'
                on_release: root.dismiss(); app.add_activity(root.ids.new_activity_name.text, root.ids.new_activity_data.text, root.ids.add_record.active)


<RoundedButton@Button>:
    bold: True
    size: self.texture_size
    font_size: sp(regular)
    padding: sp(regular * 2), sp(regular)
    color: complement_color if self.state == 'normal' else accent_color
    valign: 'center'
    halign: 'center'
    background_color: (1, 1, 1, 0)
    background_normal: ''
    background_down: ''

    canvas.before:
        Color:
            rgba: hex(third_color) if root.state == 'normal' else hex(forth_color)
        RoundedRectangle:
            size: root.size
            pos: self.pos
            radius: [sp(regular)]

<ActivityWidget>:
    name: 'Default'
    size_hint_y: None
    height: sp(h1 * 5)
    orientation: 'vertical'

    BoxLayoutCanvas:
        # bg_color: hex(main_color)

        Label:
            id: activity_name
            text: root.name

        Label:
            id: activity_data

    AnchorLayout:
        BoxLayout:
            size_hint: None, None
            size: self.minimum_width, self.minimum_height
            spacing: sp(regular)

            RoundedButton:
                text: 'Diff'
                size_hint: None, None
                padding: sp(regular), sp(regular // 2)
                on_release: root.toggle_date_diff(root)

            RoundedButton:
                text: 'Upd'
                size_hint: None, None
                padding: sp(regular), sp(regular // 2)
                on_release: root.delete_activity(root)

            RoundedButton:
                text: 'Del'
                size_hint: None, None
                padding: sp(regular), sp(regular // 2)
                on_release: root.delete_activity(root)

<Spacer@BackgroundColor>
<TopBar@BoxLayout+BackgroundColor>
<AllMovies@Screen+BackgroundColor>
<MetaOneRow@BoxLayout+BackgroundColor>
<MetaTwoGrid@GridLayout+BackgroundColor>
<ButtonsRow@BoxLayout+BackgroundColor>
<ActivityAutoRecord@BoxLayout+BackgroundColor>
<NextBtn@RoundedButton>
<PreviousBtn@RoundedButton>
<BoxLayoutCanvas@BoxLayout+BackgroundColor>
<GridLayoutCanvas@GridLayout+BackgroundColor>
<AnchorLayoutCanvas@AnchorLayout+BackgroundColor>
<FloatLayoutCanvas@FloatLayout+BackgroundColor>
<ImageCanvas@Image+BackgroundColor>
<LabelCanvas@Label+BackgroundColor>
<ScrollCanvas@ScrollView+BackgroundColor>
